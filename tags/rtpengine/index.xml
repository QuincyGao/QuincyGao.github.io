<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Rtpengine on QuincyGao Blog</title>
        <link>https://QuincyGao.github.io/tags/rtpengine/</link>
        <description>Recent content in Rtpengine on QuincyGao Blog</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <lastBuildDate>Fri, 27 Jun 2025 09:31:00 +0800</lastBuildDate><atom:link href="https://QuincyGao.github.io/tags/rtpengine/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>关于rtpengine的几个小知识(持续更新···)</title>
        <link>https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/</link>
        <pubDate>Fri, 27 Jun 2025 09:31:00 +0800</pubDate>
        
        <guid>https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/</guid>
        <description>&lt;img src="https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/backup.jpg" alt="Featured image of post 关于rtpengine的几个小知识(持续更新···)" /&gt;&lt;h2 id=&#34;背景&#34;&gt;背景 
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;rtpengine&lt;/code&gt;提供媒体代理功能, 和sip代理(&lt;code&gt;opensips&lt;/code&gt;或者&lt;code&gt;kamailio&lt;/code&gt;)一起组成完整的代理服务。&lt;/p&gt;
&lt;p&gt;针对&lt;code&gt;rtpengine&lt;/code&gt;的使用，记录几个常用方法。
rtpengine的官方文档: &lt;a class=&#34;link&#34; href=&#34;https://rtpengine.readthedocs.io/en/latest/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;rtpengine&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;当前测试的rtpegnine版本:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Version: 13.3.1.7+0~mr13.3.1.7 git-HEAD-c2223681&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;rtpengine-是否支持视频&#34;&gt;rtpengine 是否支持视频?
&lt;/h2&gt;&lt;p&gt;一直对&lt;code&gt;rtpengine&lt;/code&gt;的视频支持不是很清楚，官方文档也没有明确说明。 &lt;code&gt;rtpengine&lt;/code&gt;支持的编码有:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/codec.png&#34;
	width=&#34;950&#34;
	height=&#34;787&#34;
	srcset=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/codec_hu12619076584791487749.png 480w, https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/codec_hu13266923505063136354.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;codec&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;120&#34;
		data-flex-basis=&#34;289px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;从支持的编码上看，都是音频编码，没有视频编码，所以我也认为是不支持视频的。
最近有空,就使用&lt;code&gt;mircoSIP&lt;/code&gt;测试了视频功能，发现&lt;strong&gt;rtpengine支持视频&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;完整的一通视频sip图:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/video.png&#34;
	width=&#34;1256&#34;
	height=&#34;1080&#34;
	srcset=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/video_hu16852964672843215200.png 480w, https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/video_hu1280857307349153239.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;video&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;116&#34;
		data-flex-basis=&#34;279px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;媒体相关的信令:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/video1.png&#34;
	width=&#34;1252&#34;
	height=&#34;1019&#34;
	srcset=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/video1_hu13653633231159962865.png 480w, https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/video1_hu4486729732962569641.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;rtp&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;122&#34;
		data-flex-basis=&#34;294px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;可以看到音频用的是g711u,视频用的是h264&lt;/p&gt;
&lt;p&gt;以下这通电话的详细sdp信令:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;microSIP&lt;/code&gt;发出&lt;code&gt;INVITE&lt;/code&gt;信令:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/invite1.png&#34;
	width=&#34;889&#34;
	height=&#34;730&#34;
	srcset=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/invite1_hu6912089515113041469.png 480w, https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/invite1_hu7078452612674550690.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;invite&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;121&#34;
		data-flex-basis=&#34;292px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;可以看到既有&lt;code&gt;audio&lt;/code&gt;又有&lt;code&gt;video&lt;/code&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;code&gt;opensips&lt;/code&gt;转发&lt;code&gt;INVITE&lt;/code&gt;信令:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/invite2.png&#34;
	width=&#34;820&#34;
	height=&#34;711&#34;
	srcset=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/invite2_hu16215846185693582910.png 480w, https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/invite2_hu15579542843376868941.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;invite&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;115&#34;
		data-flex-basis=&#34;276px&#34;
	
&gt;&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;code&gt;opensips&lt;/code&gt;收到&lt;code&gt;183ring&lt;/code&gt;信令:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/1832.png&#34;
	width=&#34;918&#34;
	height=&#34;535&#34;
	srcset=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/1832_hu5386192555869744493.png 480w, https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/1832_hu6569895962313394390.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;183&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;171&#34;
		data-flex-basis=&#34;411px&#34;
	
&gt;&lt;/p&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;&lt;code&gt;opensips&lt;/code&gt;转发&lt;code&gt;183ring&lt;/code&gt;信令:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/1831.png&#34;
	width=&#34;837&#34;
	height=&#34;614&#34;
	srcset=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/1831_hu6886753494483493.png 480w, https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/1831_hu9343284717542316353.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;183&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;136&#34;
		data-flex-basis=&#34;327px&#34;
	
&gt;&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;接通之后,&lt;code&gt;microSIP&lt;/code&gt;发出媒体控制信令&lt;code&gt;INFO&lt;/code&gt;:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/info1.png&#34;
	width=&#34;1764&#34;
	height=&#34;547&#34;
	srcset=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/info1_hu15554399776819902830.png 480w, https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/info1_hu4868002238484614134.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;info&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;322&#34;
		data-flex-basis=&#34;773px&#34;
	
&gt;&lt;/p&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;&lt;code&gt;opensips&lt;/code&gt;转发&lt;code&gt;INFO&lt;/code&gt;信令:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/info2.png&#34;
	width=&#34;1738&#34;
	height=&#34;539&#34;
	srcset=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/info2_hu9334753906095252802.png 480w, https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/info2_hu14811776661729178773.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;info&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;322&#34;
		data-flex-basis=&#34;773px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;目前视频流传输这块发现&lt;code&gt;rtpengine&lt;/code&gt;有报错, 从效果来看，并没有卡顿情况:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/rtp-drop.png&#34;
	width=&#34;1799&#34;
	height=&#34;183&#34;
	srcset=&#34;https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/rtp-drop_hu12411041820750014054.png 480w, https://QuincyGao.github.io/p/%E5%85%B3%E4%BA%8Ertpengine%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B0%8F%E7%9F%A5%E8%AF%86%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/rtp-drop_hu11530559588727318733.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;warning&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;983&#34;
		data-flex-basis=&#34;2359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;综上所述， &lt;code&gt;rtpengine&lt;/code&gt;支持视频，因为没有相应的编码，所以视频流透传。&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;rtpengine-的几个codec设置&#34;&gt;rtpengine 的几个codec设置
&lt;/h2&gt;&lt;p&gt;在做媒体代理转发时,需要对&lt;code&gt;sdp&lt;/code&gt;中的&lt;code&gt;codec&lt;/code&gt;做调整, 而&lt;code&gt;sdp&lt;/code&gt;是&lt;code&gt;rtpengine&lt;/code&gt;生成的,
所以&lt;code&gt;opensips&lt;/code&gt;或者&lt;code&gt;kamailio&lt;/code&gt;调用&lt;code&gt;rtpengine_manager&lt;/code&gt;时,设置&lt;code&gt;codec&lt;/code&gt;参数可以调整&lt;code&gt;sdp&lt;/code&gt;中的&lt;code&gt;codec&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;rtpengine&lt;/code&gt;提供的参数文档为: &lt;a class=&#34;link&#34; href=&#34;https://rtpengine.readthedocs.io/en/latest/ng_control_protocol.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ng_control_protocol&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;codec-transcode&#34;&gt;codec-transcode
&lt;/h3&gt;&lt;h4 id=&#34;介绍&#34;&gt;介绍 
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;transcode&lt;/code&gt; 官方的解释是：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Similar to &lt;code&gt;offer&lt;/code&gt; but allows codecs to be added to the list of offered codecs
even if they were not present in the original list of codecs. In this case,
the transcoding engine will be engaged. Only codecs that are supported for both
decoding and encoding can be added in this manner. This also has the side effect
of automatically stripping all unsupported codecs from the list of offered codecs,
as &lt;em&gt;rtpengine&lt;/em&gt; must expect to receive or even send in any codec that is present
in the list.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;意思就是： 可以添加原编码列表中没有的新编码，这个新的编码必须是&lt;code&gt;rtpengine&lt;/code&gt;支持的&lt;code&gt;fully supported&lt;/code&gt;的&lt;code&gt;codecs&lt;/code&gt;.
此时会启用转码功能。另外也可以通过&lt;code&gt;opus/48000/2/32000&lt;/code&gt;这样，设置采样率，声道数。&lt;/p&gt;
&lt;h4 id=&#34;验证&#34;&gt;验证
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;收到&lt;code&gt;INVITE&lt;/code&gt;的&lt;code&gt;sdp&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=- 3959936153 3959936153 IN IP4 172.16.80.13
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=pjmedia
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=AS:84
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=X-nat:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 4004 RTP/AVP 0 8 101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.80.13
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=TIAS:64000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:4005 IN IP4 172.16.80.13
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=sendrecv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:0 PCMU/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:8 PCMA/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:101 telephone-event/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=fmtp:101 0-16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ssrc:13774595 cname:5e6c1f45683b7a88
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;在收到&lt;code&gt;INVITE&lt;/code&gt;请求转发时，分别设置:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;codec-transcode-PCMU&lt;/code&gt;(源sdp含有的codecs)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;转发&lt;code&gt;INVITE&lt;/code&gt;时的&lt;code&gt;sdp&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=- 3959936153 3959936153 IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=pjmedia
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=AS:84
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=X-nat:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 30978 RTP/AVP 0 8 101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=TIAS:64000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:0 PCMU/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:8 PCMA/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:101 telephone-event/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=fmtp:101 0-16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ssrc:13774595 cname:5e6c1f45683b7a88
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=sendrecv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:30979
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;可以看到，源&lt;code&gt;sdp&lt;/code&gt;中有&lt;code&gt;PCMU&lt;/code&gt;,所以&lt;code&gt;codec-transcode-PCMU&lt;/code&gt;其实不起作用.&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;code&gt;codec-transcode-G722&lt;/code&gt;(源sdp没有的codecs)
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=- 3959936715 3959936715 IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=pjmedia
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=AS:84
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=X-nat:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 32292 RTP/AVP 0 8 9 101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=TIAS:64000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:0 PCMU/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:8 PCMA/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:9 G722/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:101 telephone-event/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=fmtp:101 0-16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ssrc:521813100 cname:25e0395673a04af0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=sendrecv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:32293
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;可以看到新增了&lt;code&gt;G722&lt;/code&gt;编码&lt;/p&gt;
&lt;p&gt;当和&lt;code&gt;codec-strip-all codec-mask-all&lt;/code&gt;一起使用时,&lt;code&gt;codec-transcode-PCMU&lt;/code&gt;不会启用转码,&lt;code&gt;codec-transcode-G722&lt;/code&gt;会启用转码.&lt;/p&gt;
&lt;h3 id=&#34;codec-strip&#34;&gt;codec-strip
&lt;/h3&gt;&lt;h4 id=&#34;介绍-1&#34;&gt;介绍
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;strip&lt;/code&gt; 官方的解释是：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Contains a list of strings. Each string is the name of a codec or RTP payload
type that should be removed from the SDP. Codec names are case sensitive, and
can be either from the list of codecs explicitly defined by the SDP through
an &lt;code&gt;a=rtpmap&lt;/code&gt; attribute, or can be from the list of RFC-defined codecs. Examples
are &lt;code&gt;PCMU&lt;/code&gt;, &lt;code&gt;opus&lt;/code&gt;, or &lt;code&gt;telephone-event&lt;/code&gt;. Codecs stripped using this option
are only removed from the outgoing rewritten SDP and don&amp;rsquo;t affect the list
of codecs that was offered by the source SDP. See the &lt;code&gt;ignore&lt;/code&gt; option above
for a similar mechanism that affects the offer codecs.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;意思就是： 从&lt;code&gt;sdp&lt;/code&gt;中移除指定的编码. 可以是具体的某个编码,也可以是&lt;code&gt;all&lt;/code&gt;or&lt;code&gt;full&lt;/code&gt;移除所有编码.&lt;/p&gt;
&lt;h4 id=&#34;验证-1&#34;&gt;验证
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;收到&lt;code&gt;INVITE&lt;/code&gt;的&lt;code&gt;sdp&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=- 3959936153 3959936153 IN IP4 172.16.80.13
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=pjmedia
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=AS:84
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=X-nat:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 4004 RTP/AVP 0 8 101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.80.13
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=TIAS:64000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:4005 IN IP4 172.16.80.13
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=sendrecv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:0 PCMU/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:8 PCMA/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:101 telephone-event/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=fmtp:101 0-16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ssrc:13774595 cname:5e6c1f45683b7a88
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;codec-strip-PCMU&lt;/code&gt;(源sdp含有的codecs)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;转发&lt;code&gt;INVITE&lt;/code&gt;时的&lt;code&gt;sdp&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=- 3959938742 3959938742 IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=pjmedia
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=AS:84
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=X-nat:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 31172 RTP/AVP 8 101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=TIAS:64000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:8 PCMA/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:101 telephone-event/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=fmtp:101 0-16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ssrc:511262327 cname:3746229c63e96846
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=sendrecv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:31173
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;可以看到&lt;code&gt;PCMU&lt;/code&gt;被删除了.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;codec-strip-G722&lt;/code&gt;(源sdp没有的codecs)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;转发&lt;code&gt;INVITE&lt;/code&gt;时的&lt;code&gt;sdp&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=- 3959938899 3959938899 IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=pjmedia
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=AS:84
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=X-nat:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 30892 RTP/AVP 0 8 101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=TIAS:64000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:0 PCMU/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:8 PCMA/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:101 telephone-event/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=fmtp:101 0-16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ssrc:1565081695 cname:50952bd21cbd44c8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=sendrecv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:30893
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;可以看到没有任何变化.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;codec-strip-all&lt;/code&gt;(删除所有)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;转发&lt;code&gt;INVITE&lt;/code&gt;时的&lt;code&gt;sdp&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=- 3959939030 3959939030 IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=pjmedia
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=AS:84
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=X-nat:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 32560 RTP/AVP 0 8 101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=TIAS:64000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:0 PCMU/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:8 PCMA/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:101 telephone-event/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=fmtp:101 0-16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ssrc:1854882148 cname:0baf6e5578824b50
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=sendrecv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:32561
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;可以看到好像并没有变化,查看&lt;code&gt;rtpengine&lt;/code&gt;的日志，有&lt;code&gt;Warning&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[1750921364.090656] DEBUG: [0349a2eed9304f22ac7cb87970e1d5f7]: [codec] Stripping codec PCMU/8000/ (0) due to strip=all or strip=full
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[1750921364.090663] DEBUG: [0349a2eed9304f22ac7cb87970e1d5f7]: [codec] Stripping codec PCMA/8000/ (8) due to strip=all or strip=full
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[1750921364.090666] DEBUG: [0349a2eed9304f22ac7cb87970e1d5f7]: [codec] Stripping codec telephone-event/8000/0-16 (101) due to strip=all or strip=full
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[1750921364.090669] WARNING: [0349a2eed9304f22ac7cb87970e1d5f7]: [core] Usage error: List of codecs empty. Restoring original list of codecs. Results may be unexpected.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;code&gt;rtpengine&lt;/code&gt;触发了保护机制,不允许删除所有的&lt;code&gt;codecs&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;如果想查看效果，可以这样用&lt;code&gt;codec-strip-all codec-transcode-G722&lt;/code&gt;删除所有,新增&lt;code&gt;G722&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=- 3959939604 3959939604 IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=pjmedia
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=AS:84
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=X-nat:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 32710 RTP/AVP 9
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=TIAS:64000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:9 G722/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ssrc:607722213 cname:2664202b2fde465f
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=sendrecv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:32711
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;codec-mask&#34;&gt;codec-mask
&lt;/h3&gt;&lt;h4 id=&#34;介绍-2&#34;&gt;介绍
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;mask&lt;/code&gt; 官方的解释是：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Similar to &lt;code&gt;strip&lt;/code&gt; except that codecs listed here will still be accepted and
used for transcoding on the offering side. Useful only in combination with
&lt;code&gt;transcode&lt;/code&gt;. For example, if an offer advertises Opus and the options
&lt;code&gt;mask=opus, transcode=G723&lt;/code&gt; are given, then the rewritten outgoing offer
will contain only G.723 as offered codec, and transcoding will happen
between Opus and G.723. In contrast, if only &lt;code&gt;transcode=G723&lt;/code&gt; were given, then
the rewritten outgoing offer would contain both Opus and G.723. On the other
hand, if &lt;code&gt;strip=opus, transcode=G723&lt;/code&gt; were given, then Opus would be unavailable
for transcoding.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;意思就是: 功能和&lt;code&gt;strip&lt;/code&gt;类似,如果和&lt;code&gt;transcode&lt;/code&gt;一起使用, 会设置&lt;code&gt;A-leg&lt;/code&gt;方向的编码,也可以设置&lt;code&gt;all&lt;/code&gt;or&lt;code&gt;full&lt;/code&gt;。
正常情况下, &lt;code&gt;A---- opensips ----B&lt;/code&gt;, &lt;code&gt;B&lt;/code&gt;返回&lt;code&gt;200OK&lt;/code&gt;的编码,&lt;code&gt;opensips&lt;/code&gt;会透传给&lt;code&gt;A&lt;/code&gt;,
但是如果想改变&lt;code&gt;opensips---A&lt;/code&gt;的&lt;code&gt;200OK&lt;/code&gt;编码，就需要设置&lt;code&gt;mask&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;目前实际测试情况不太一样，并没有达到官方描述的效果，不知道是否是使用方法问题。&lt;/p&gt;
&lt;h4 id=&#34;验证-2&#34;&gt;验证
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;收到&lt;code&gt;INVITE&lt;/code&gt;的&lt;code&gt;sdp&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=- 3959936153 3959936153 IN IP4 172.16.80.13
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=pjmedia
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=AS:84
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=X-nat:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 4004 RTP/AVP 0 8 101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.80.13
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=TIAS:64000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:4005 IN IP4 172.16.80.13
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=sendrecv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:0 PCMU/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:8 PCMA/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:101 telephone-event/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=fmtp:101 0-16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ssrc:13774595 cname:5e6c1f45683b7a88
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;codec-mask-PCMA&lt;/code&gt;(源sdp含有的codecs)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;转发&lt;code&gt;INVITE&lt;/code&gt;时的&lt;code&gt;sdp&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=- 3959940641 3959940641 IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=pjmedia
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=AS:84
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=X-nat:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 32792 RTP/AVP 0 101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=TIAS:64000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:0 PCMU/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:101 telephone-event/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=fmtp:101 0-16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ssrc:88031142 cname:45af19894aea3926
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=sendrecv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:32793
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;可以看到&lt;code&gt;PCMA&lt;/code&gt;被删除了, 如果和&lt;code&gt;codec-transcode-G722&lt;/code&gt;一起使用(&lt;code&gt;codec-mask-PCMU codec-transcode-G722&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;转发&lt;code&gt;INVITE&lt;/code&gt;时的&lt;code&gt;sdp&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=- 3960007402 3960007402 IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=pjmedia
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=AS:84
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=X-nat:0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 32762 RTP/AVP 8 9 101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;b=TIAS:64000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:8 PCMA/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:9 G722/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:101 telephone-event/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=fmtp:101 0-16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ssrc:692681591 cname:3de5725421f15ecd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=sendrecv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:32763
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;可以看到&lt;code&gt;PCMU&lt;/code&gt;被删除了，这点和&lt;code&gt;strip&lt;/code&gt;功能一样.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;接收&lt;code&gt;200OK&lt;/code&gt;时的&lt;code&gt;sdp&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=FreeSWITCH 1750959462 1750959463 IN IP4 172.16.4.114
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=FreeSWITCH
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.4.114
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 30016 RTP/AVP 9 101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:9 G722/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:101 telephone-event/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=fmtp:101 0-16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ptime:20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:30017 IN IP4 172.16.4.114
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;此时&lt;code&gt;B-leg&lt;/code&gt;选择的是&lt;code&gt;G722&lt;/code&gt;,这个编码是&lt;code&gt;A-leg&lt;/code&gt;发送&lt;code&gt;INVITE&lt;/code&gt;时没有的编码,
此时&lt;code&gt;rtpengine&lt;/code&gt;会默认选择收到&lt;code&gt;INVITE&lt;/code&gt;中第一个编码&lt;code&gt;PCMU&lt;/code&gt;返回。
&lt;code&gt;opensips&lt;/code&gt;转发&lt;code&gt;200OK&lt;/code&gt;时的&lt;code&gt;sdp&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=FreeSWITCH 1750959462 1750959463 IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=FreeSWITCH
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 30292 RTP/AVP 0 101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:0 PCMU/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:101 telephone-event/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=fmtp:101 0-16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=sendrecv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:30293
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ptime:20
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;我试过了就算设置成&lt;code&gt;codec-mask-PCMA&lt;/code&gt;,这里返回的还是&lt;code&gt;PCMU&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;此场景下, 还测了&lt;code&gt;codec-strip-PCMU codec-transcode-G722&lt;/code&gt;,效果是一样的，还是使用默认编码&lt;code&gt;PCMU&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;如果&lt;code&gt;B-leg&lt;/code&gt;选择的是&lt;code&gt;PCMA&lt;/code&gt;,情况如下:
&lt;code&gt;opensips&lt;/code&gt;接收&lt;code&gt;200OK&lt;/code&gt;时的&lt;code&gt;sdp&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=FreeSWITCH 1750959265 1750959266 IN IP4 172.16.4.114
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=FreeSWITCH
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.4.114
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 30000 RTP/AVP 8 101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:8 PCMA/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:101 telephone-event/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=fmtp:101 0-16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ptime:20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:30001 IN IP4 172.16.4.114
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;转发&lt;code&gt;200OK&lt;/code&gt;时的&lt;code&gt;sdp&lt;/code&gt;信息:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v=0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;o=FreeSWITCH 1750959265 1750959266 IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;s=FreeSWITCH
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;t=0 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;m=audio 32536 RTP/AVP 8 101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;c=IN IP4 172.16.4.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:8 PCMA/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtpmap:101 telephone-event/8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=fmtp:101 0-16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=sendrecv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=rtcp:32537
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;a=ptime:20
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;可以看到转发&lt;code&gt;A-leg&lt;/code&gt;时的&lt;code&gt;200OK&lt;/code&gt;选择的是&lt;code&gt;PCMA&lt;/code&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        <item>
        <title>rtpengine 按键转换</title>
        <link>https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/</link>
        <pubDate>Tue, 10 Jun 2025 16:24:48 +0800</pubDate>
        
        <guid>https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/</guid>
        <description>&lt;img src="https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/backup.jpg" alt="Featured image of post rtpengine 按键转换" /&gt;&lt;h2 id=&#34;背景&#34;&gt;背景
&lt;/h2&gt;&lt;p&gt;在上一章中，我们介绍了&lt;code&gt;dtmf&lt;/code&gt;按键功能，可以看到&lt;code&gt;rtpengine&lt;/code&gt;能够把收到的&lt;code&gt;rfc2833&lt;/code&gt;和&lt;code&gt;inbound&lt;/code&gt;类型的&lt;code&gt;dtmf&lt;/code&gt;透传到&lt;code&gt;uas&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;在实际项目中, 我们可能还需要对&lt;code&gt;dtmf&lt;/code&gt;做按键类型转换, 在&lt;code&gt;rtpengine&lt;/code&gt;的官方文档&lt;a class=&#34;link&#34; href=&#34;https://rtpengine.readthedocs.io/en/latest/transcoding.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;transcoding&lt;/a&gt;中，我们找到这样一段话：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Rtpengine supports transcoding between RFC 2833/4733 DTMF event packets (telephone-event payloads) and in-band DTMF audio tones. When enabled, rtpengine translates DTMF event packets to in-band DTMF audio by generating DTMF tones and injecting them into the audio stream, and translates in-band DTMF tones by running the audio stream through a DSP, and generating DTMF event packets when a DTMF tone is detected.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;所以可以得知&lt;code&gt;rfc2833/4733&lt;/code&gt;和&lt;code&gt;inbound&lt;/code&gt;类型可以互相转换。&lt;/p&gt;
&lt;p&gt;本次测试的rtpengine版本:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Version: 13.1.0.0+0~mr13.1.0.0 git-heads/mr13.0.1.2-3ac08574&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;rfc2833-转inbound&#34;&gt;rfc2833 转inbound
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;在&lt;code&gt;opensips&lt;/code&gt;在转发&lt;code&gt;invite&lt;/code&gt;时,&lt;code&gt;rtpengine_manager&lt;/code&gt;里,参数设置如下:&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;always-transcode codec-mask-all codec-transcode-telephone-event codec-strip-telephone-event&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;通过抓包得到的结果如下:
&lt;img src=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip.png&#34;
	width=&#34;1125&#34;
	height=&#34;1005&#34;
	srcset=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip_hu15014411371689715799.png 480w, https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip_hu5122431649787902314.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;sip&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;111&#34;
		data-flex-basis=&#34;268px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;转发给&lt;code&gt;uas&lt;/code&gt;的&lt;code&gt;RTP&lt;/code&gt;按键内容为:
&lt;img src=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/dtmf.png&#34;
	width=&#34;1872&#34;
	height=&#34;915&#34;
	srcset=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/dtmf_hu5880551696720063172.png 480w, https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/dtmf_hu15925254528221308044.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;inbound&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;204&#34;
		data-flex-basis=&#34;491px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;所以可以确定&lt;code&gt;rfc2833&lt;/code&gt;转&lt;code&gt;inbound&lt;/code&gt;成功。&lt;/p&gt;
&lt;p&gt;另外&lt;code&gt;uac&lt;/code&gt;发送的&lt;code&gt;invite&lt;/code&gt;的&lt;code&gt;SDP&lt;/code&gt;信息为:
&lt;img src=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip1.png&#34;
	width=&#34;892&#34;
	height=&#34;584&#34;
	srcset=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip1_hu5290505663922169746.png 480w, https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip1_hu4996879167443248996.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;sip&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;152&#34;
		data-flex-basis=&#34;366px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;转发给&lt;code&gt;uas&lt;/code&gt;的&lt;code&gt;invite&lt;/code&gt;的&lt;code&gt;sdp&lt;/code&gt;信息：
&lt;img src=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip2.png&#34;
	width=&#34;1068&#34;
	height=&#34;479&#34;
	srcset=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip2_hu5165391912126913881.png 480w, https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip2_hu16198163867904016068.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;sip&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;222&#34;
		data-flex-basis=&#34;535px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;可能有点问题的是： 这个转发的&lt;code&gt;invite&lt;/code&gt;居然把&lt;code&gt;media&lt;/code&gt;相关的信息都去掉了。&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;strong&gt;20250623 修正&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;转发&lt;code&gt;invite&lt;/code&gt;时,&lt;code&gt;rtpengine_manager&lt;/code&gt;参数设置为:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;always-transcode codec-strip-telephone-event DTLS=off SDES-off ICE=remove RTP/AVP&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;从&lt;code&gt;uac&lt;/code&gt;发送过来的&lt;code&gt;invite&lt;/code&gt;sip信令图为:
&lt;img src=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip5.png&#34;
	width=&#34;1163&#34;
	height=&#34;602&#34;
	srcset=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip5_hu9327989611100319860.png 480w, https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip5_hu17067266626547741145.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;invite&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;193&#34;
		data-flex-basis=&#34;463px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;转发给&lt;code&gt;uas&lt;/code&gt;的&lt;code&gt;invite&lt;/code&gt;信令图为:
&lt;img src=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip6.png&#34;
	width=&#34;1122&#34;
	height=&#34;638&#34;
	srcset=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip6_hu9330582260912443093.png 480w, https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip6_hu6235923013581141086.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;invite&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;175&#34;
		data-flex-basis=&#34;422px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;可以看到转发的&lt;code&gt;invite&lt;/code&gt;只是去掉了&lt;code&gt;telephone-event&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;收到&lt;code&gt;183ring&lt;/code&gt;或者&lt;code&gt;200OK&lt;/code&gt;时的&lt;code&gt;rtpengine_manager&lt;/code&gt;参数为:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;DTLS=off SDES-off ICE=remove RTP/AVP&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;从&lt;code&gt;uas&lt;/code&gt;返回的&lt;code&gt;183ring&lt;/code&gt;或者&lt;code&gt;200OK&lt;/code&gt;的&lt;code&gt;sip&lt;/code&gt;信令图为:
&lt;img src=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip7.png&#34;
	width=&#34;1152&#34;
	height=&#34;552&#34;
	srcset=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip7_hu17983437937410682513.png 480w, https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip7_hu15203018671373473920.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;sip&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;208&#34;
		data-flex-basis=&#34;500px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;从&lt;code&gt;opensips&lt;/code&gt;返回给软电话的&lt;code&gt;183ring&lt;/code&gt;或者&lt;code&gt;200OK&lt;/code&gt;的&lt;code&gt;sip&lt;/code&gt;信令图为:
&lt;img src=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip8.png&#34;
	width=&#34;1223&#34;
	height=&#34;643&#34;
	srcset=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip8_hu3814141998817139635.png 480w, https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip8_hu13159500349360019671.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;sip&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;190&#34;
		data-flex-basis=&#34;456px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;可以看到返回的&lt;code&gt;183ring&lt;/code&gt;或者&lt;code&gt;200OK&lt;/code&gt;的&lt;code&gt;sip&lt;/code&gt;信令,新增了&lt;code&gt;telephone-event&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;整体信令图：
&lt;img src=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip9.png&#34;
	width=&#34;1332&#34;
	height=&#34;1058&#34;
	srcset=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip9_hu4084722228091885177.png 480w, https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip9_hu11484604453480368954.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;sip&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;125&#34;
		data-flex-basis=&#34;302px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;可以看到&lt;code&gt;rfc2833&lt;/code&gt;被转成了&lt;code&gt;inbound&lt;/code&gt;, 这种方式比方案1更好。&lt;/p&gt;
&lt;h2 id=&#34;inbound-转rfc2833&#34;&gt;inbound 转rfc2833
&lt;/h2&gt;&lt;p&gt;目前没有成功,我用了&lt;code&gt;always-transcode detect-DTMF codec-transcode-telephone-event codec-strip=telephone-event&lt;/code&gt;
和&lt;code&gt;always-transcode inject-DTMF codec-transcode-telephone-event codec-strip=telephone-event&lt;/code&gt;,都没转成功。&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;rtpengine&lt;/code&gt;的group发的帖子,一直自动删除. 后面如果有成功的,会在这里补充。&lt;/p&gt;
&lt;h2 id=&#34;info-转-rfc2833&#34;&gt;INFO 转 rfc2833
&lt;/h2&gt;&lt;p&gt;按键&lt;code&gt;INFO&lt;/code&gt;的&lt;code&gt;sip&lt;/code&gt;信令如下:
&lt;img src=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip3.png&#34;
	width=&#34;1299&#34;
	height=&#34;483&#34;
	srcset=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip3_hu6563820721585249387.png 480w, https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip3_hu17007571019150523539.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;sip&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;268&#34;
		data-flex-basis=&#34;645px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;可以看到按键的&lt;code&gt;INFO&lt;/code&gt;的&lt;code&gt;sip&lt;/code&gt;头里的&lt;code&gt;content-type&lt;/code&gt;为&lt;code&gt;application/dtmf-relay&lt;/code&gt;,
&lt;code&gt;BODY&lt;/code&gt;里的&lt;code&gt;Signal&lt;/code&gt;即为按键内容。&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;opensips&lt;/code&gt;的配置中，设置如下:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-gdscript3&#34; data-lang=&#34;gdscript3&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_method&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;INFO&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/dtmf-relay&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;signal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;substr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;signal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;signalNumber&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;signal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;substr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;xlog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;L_DBG&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[$cfg_line][$ci]---info--:$rm|$rs|$tu|---receive dtmf:$rb,signal:$var(signal),number:$var(signalNumber)&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;rtpengine_play_dtmf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;signalNumber&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;sl_send_reply&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;200&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;OK&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;能接收的按键为:&lt;code&gt;(0-9)&lt;/code&gt;和&lt;code&gt;(*,#,A,B,C,D)&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;另外还要在转发的&lt;code&gt;invite&lt;/code&gt;,生成&lt;code&gt;SDP&lt;/code&gt;信息时，&lt;code&gt;rtpengine_manager&lt;/code&gt;的参数添加如下:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;always-transcode inject-DTMF codec-mask-all&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;实际抓包的&lt;code&gt;sip&lt;/code&gt;信令如下:
&lt;img src=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip4.png&#34;
	width=&#34;1078&#34;
	height=&#34;895&#34;
	srcset=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip4_hu8694893111416807780.png 480w, https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/sip4_hu5664660785981370699.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;sip&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;120&#34;
		data-flex-basis=&#34;289px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;确实可以看到&lt;code&gt;INFO&lt;/code&gt;转成了&lt;code&gt;rfc2833&lt;/code&gt;类型的按键。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;uac&lt;/code&gt;发送的&lt;code&gt;invite&lt;/code&gt;的&lt;code&gt;SDP&lt;/code&gt;信息为:
&lt;img src=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/dtmf1.png&#34;
	width=&#34;1012&#34;
	height=&#34;531&#34;
	srcset=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/dtmf1_hu17816362718974717633.png 480w, https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/dtmf1_hu5051137423468223527.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;sdp&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;190&#34;
		data-flex-basis=&#34;457px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;opensips&lt;/code&gt;转发给&lt;code&gt;uas&lt;/code&gt;的&lt;code&gt;invite&lt;/code&gt;的&lt;code&gt;sdp&lt;/code&gt;信息：
&lt;img src=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/dtmf2.png&#34;
	width=&#34;972&#34;
	height=&#34;585&#34;
	srcset=&#34;https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/dtmf2_hu17368038805251718829.png 480w, https://QuincyGao.github.io/p/rtpengine-%E6%8C%89%E9%94%AE%E8%BD%AC%E6%8D%A2/dtmf2_hu7569315965878125715.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;sdp&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;166&#34;
		data-flex-basis=&#34;398px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;info-转-inbound&#34;&gt;INFO 转 inbound
&lt;/h2&gt;&lt;p&gt;暂未成功。&lt;/p&gt;
&lt;h2 id=&#34;总结&#34;&gt;总结
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;code&gt;rtpengine&lt;/code&gt;的按键转换功能, 目前验证成功是&lt;code&gt;rfc2833&lt;/code&gt;转&lt;code&gt;inbound&lt;/code&gt;和&lt;code&gt;INFO&lt;/code&gt;转&lt;code&gt;rfc2833&lt;/code&gt;。&lt;code&gt;inbound&lt;/code&gt;转&lt;code&gt;rfc2833&lt;/code&gt;和&lt;code&gt;INFO&lt;/code&gt;转&lt;code&gt;inbound&lt;/code&gt;暂未成功。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;rfc2833&lt;/code&gt;或者&lt;code&gt;inbound&lt;/code&gt;应该不能转成&lt;code&gt;INFO&lt;/code&gt;类型。&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        
    </channel>
</rss>
